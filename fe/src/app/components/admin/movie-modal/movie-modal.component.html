<div class="modal-container">
  @if (isBusy) {
  <div class="busy-overlay">
    <div class="busy-box">
      <div class="spinner-border mb-3" role="status"></div>
      <div class="fw-semibold">{{ busyText }}</div>
      <div class="text-muted small">Vui l√≤ng ƒë·ª£i‚Ä¶</div>
    </div>
  </div>
  }

  <div class="modal-header">
    <div class="header-content">
      <h2 class="modal-title">
        {{ isEditMode ? 'S·ª≠a Phim' : 'Th√™m Phim M·ªõi' }}
      </h2>
      <p class="modal-subtitle">
        {{ isEditMode ? 'C·∫≠p nh·∫≠t th√¥ng tin phim c·ªßa b·∫°n' : 'T·∫°o phim m·ªõi cho th∆∞ vi·ªán' }}
      </p>
    </div>
    <button type="button" class="close-btn" (click)="cancel()" aria-label="ƒê√≥ng">‚úï</button>
  </div>

  <!-- tabs (ch·ªâ hi·ªÉn th·ªã khi edit) -->
  @if (isEditMode) {
  <div class="tabs-navigation" role="tablist" aria-label="Media tabs">
    <button type="button" class="tab-btn" [class.active]="activeTab === 'info'" (click)="switchTab('info')" role="tab"
      [attr.aria-selected]="activeTab === 'info'">
      <span class="tab-icon">‚ÑπÔ∏è</span>
      Th√¥ng Tin
    </button>

    <button type="button" class="tab-btn" [class.active]="activeTab === 'images'" (click)="switchTab('images')"
      role="tab" [attr.aria-selected]="activeTab === 'images'">
      <span class="tab-icon">üñºÔ∏è</span>
      ·∫¢nh
    </button>

    <button type="button" class="tab-btn" [class.active]="activeTab === 'videos'" (click)="switchTab('videos')"
      role="tab" [attr.aria-selected]="activeTab === 'videos'">
      <span class="tab-icon">üé¨</span>
      Video
    </button>

    <button type="button" class="tab-btn" [class.active]="activeTab === 'subtitles'" (click)="switchTab('subtitles')"
      role="tab" [attr.aria-selected]="activeTab === 'subtitles'">
      <span class="tab-icon">üìù</span>
      Ph·ª• ƒê·ªÅ
    </button>
  </div>
  }

  <!-- Content Area -->
  <div class="modal-content">
    @if (activeTab === 'info' || !isEditMode) {
    <app-movie-info [infoForm]="infoForm" [genres]="genres" [studios]="studios" [movieTypeEntries]="movieTypeEntries"
      [publishStatusEntries]="publishStatusEntries" (toggleGenre)="toggleGenreId($event)"
      (toggleStudio)="toggleStudioId($event)"></app-movie-info>
    }

    @if (activeTab === 'images' && isEditMode) {
    <app-movie-images [selectedPosters]="selectedPosters" [selectedBackdrops]="selectedBackdrops"
      [currentPosterUrl]="movie?.posterUrl || null" [currentBackdropUrl]="movie?.backdropUrl || null"
      (postersSelected)="onPosterFilesSelected($event)" (backdropsSelected)="onBackdropFilesSelected($event)"
      (removePoster)="removePoster($event)" (removeBackdrop)="removeBackdrop($event)"></app-movie-images>
    }

    @if (activeTab === 'videos' && isEditMode) {
    <app-movie-videos [infoForm]="infoForm" [movie]="movie" [videos]="videos" [seasons]="seasons"
      [epsBySeason]="epsBySeason" [videosByEpisode]="videosByEpisode" (addSeason)="addSeason()"
      (renameSeason)="renameSeason($event)" (deleteSeason)="deleteSeason($event)"
      (uploadMovieVideo)="onUploadMovieVideo($event)"
      (uploadEpisodeVideo)="onUploadEpisodeVideo($event.season,$event.episode,$event.file)"
      (addEpisode)="addEpisode($event)" (saveEpisode)="saveEpisode($event)"
      (deleteEpisode)="deleteEpisode($event.season,$event.episode)" (deleteAsset)="removeVideoByAsset($event)"
      (goSubtitle)="goSubtitleForAsset($event)"></app-movie-videos>
    }

    @if (activeTab === 'subtitles' && isEditMode) {
    <app-movie-subtitles [subtitles]="subtitles" (subtitlesSelected)="onSubtitleFileSelected($event)"
      (deleteSubtitle)="removeSubtitle($event)"></app-movie-subtitles>
    }
  </div>

  <!-- Footer Actions -->
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="cancel()">H·ªßy</button>
    <button type="button" class="btn btn-primary" [disabled]="!infoForm.valid" (click)="submit()">
      {{ isEditMode ? 'C·∫≠p Nh·∫≠t' : 'T·∫°o M·ªõi' }}
    </button>
  </div>
</div>