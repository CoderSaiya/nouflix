<header class="header">
  <div class="container">
    <div class="header-content">
      <div class="header-left">
        <a routerLink="/" class="logo">
          <span class="logo-text">NouFlix</span>
        </a>

        <nav class="nav-desktop">
          <a routerLink="/" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}">Trang Chủ</a>
          <a routerLink="/genre/1" routerLinkActive="active">Phim Mới</a>
          <div class="dropdown">
            <button class="dropdown-toggle">Thể Loại</button>
            <div class="dropdown-menu">
              <a *ngFor="let genre of genres" [routerLink]="['/genre', genre.id]">
                {{ genre.name }}
              </a>
            </div>
          </div>
          <a routerLink="/search" routerLinkActive="active">Tìm Kiếm</a>
        </nav>
      </div>

      <div class="header-right">
        <button class="icon-btn" (click)="toggleSearch()" aria-label="Search">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
        </button>

        <ng-container *ngIf="authService.isAuthenticated(); else guest">
          <div class="user-menu-wrapper">
            <button class="user-avatar-btn" (click)="toggleUserMenu()" aria-label="User menu">
              @if (authService.currentUser()?.avatar) {
                <img [src]="authService.currentUser()?.avatar" alt="Avatar" class="user-avatar-img" />
              } @else {
                <div class="user-avatar-placeholder">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                  </svg>
                </div>
              }
            </button>

            @if (isUserMenuOpen) {
              <div class="user-dropdown">
                <div class="user-dropdown-header">
                  <p class="user-name">
                    <ng-container *ngIf="(authService.currentUser()?.firstName || authService.currentUser()?.lastName); else noname">
                      {{ authService.currentUser()?.firstName }} {{ authService.currentUser()?.lastName }}
                    </ng-container>
                    <ng-template #noname>Người dùng</ng-template>
                  </p>
                  <p class="user-email">{{ authService.currentUser()?.email }}</p>
                </div>
                <div class="user-dropdown-divider"></div>
                <a routerLink="/profile" class="user-dropdown-item" (click)="toggleUserMenu()">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                  </svg>
                  <span>Thông tin cá nhân</span>
                </a>
                <button class="user-dropdown-item" (click)="onLogout()">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                    <polyline points="16 17 21 12 16 7"></polyline>
                    <line x1="21" y1="12" x2="9" y2="12"></line>
                  </svg>
                  <span>Đăng xuất</span>
                </button>
              </div>
            }
          </div>
        </ng-container>

        <ng-template #guest>
          <a routerLink="/login" class="btn btn-primary btn-small">Đăng Nhập</a>
        </ng-template>

        <button class="icon-btn mobile-menu-btn" (click)="toggleMenu()" aria-label="Menu">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
          </svg>
        </button>
      </div>
    </div>

    <div class="search-bar" [class.active]="isSearchOpen">
      <input
        id="search-input"
        type="text"
        placeholder="Tìm kiếm phim..."
        [(ngModel)]="searchQuery"
        (keyup.enter)="onSearch()"
      />
      <button (click)="onSearch()" aria-label="Search">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.35-4.35"></path>
        </svg>
      </button>
    </div>
  </div>

  <nav class="mobile-nav" [class.active]="isMenuOpen">
    <a routerLink="/" (click)="toggleMenu()">Trang Chủ</a>
    <a routerLink="/genre/1" (click)="toggleMenu()">Phim Mới</a>
    <div class="mobile-genres">
      <p class="mobile-genres-title">Thể Loại</p>
      <a *ngFor="let genre of genres" [routerLink]="['/genre', genre.id]" (click)="toggleMenu()">
        {{ genre.name }}
      </a>
    </div>
    <a routerLink="/search" (click)="toggleMenu()">Tìm Kiếm</a>

    @if (authService.isAuthenticated()) {
      <a routerLink="/profile" (click)="toggleMenu()">Thông tin cá nhân</a>
      <a (click)="onLogout(); toggleMenu()" style="cursor: pointer;">Đăng xuất</a>
    } @else {
      <a routerLink="/login" (click)="toggleMenu()">Đăng Nhập</a>
      <a routerLink="/register" (click)="toggleMenu()">Đăng Ký</a>
    }
  </nav>
</header>
