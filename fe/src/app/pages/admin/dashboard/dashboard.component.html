<div class="dashboard-container">

  @if (isLoading) {
    <div class="chart-card">
      <div>ƒêang t·∫£i d·ªØ li·ªáu‚Ä¶</div>
    </div>
  }

  @if (!isLoading && stats) {
    <div class="stats-grid">
      <app-stat-card
        title="T·ªïng Phim"
        [value]="formatNumber(stats.kpis.totalMovies || 0)"
        icon="üé¨"
        trend=""
      ></app-stat-card>

      <app-stat-card
        title="ƒê√£ xu·∫•t b·∫£n"
        [value]="formatNumber(stats.kpis.publishedMovies || 0)"
        icon="‚úÖ"
        trend=""
      ></app-stat-card>

      <app-stat-card
        title="T·ªïng T·∫≠p"
        [value]="formatNumber(stats.kpis.totalEpisodes || 0)"
        icon="üì∫"
        trend=""
      ></app-stat-card>

      <app-stat-card
        title="T·ªïng T√†i S·∫£n"
        [value]="formatNumber(stats.kpis.totalAssets || 0)"
        icon="üóÇÔ∏è"
        trend=""
      ></app-stat-card>
    </div>

    <div class="charts-section" style="align-items: start;">
      <div class="chart-card">
        <h2 class="chart-title">T·ªïng k√≠ch th∆∞·ªõc b·ªô nh·ªõ</h2>
        <!-- line: hi·ªÉn th·ªã imageBytes vs videoBytes vs totalBytes -->
        <app-chart
          type="bar"
          [labels]="['Images','Videos','Total']"
          [values]="[stats.kpis.imageBytes || 0, stats.kpis.videoBytes || 0, stats.kpis.totalBytes || 0]"
        ></app-chart>
        <div style="margin-top:0.75rem; font-size:0.9rem; color:var(--color-text-secondary)">
          Image: {{ formatBytes(stats.kpis.imageBytes || 0) }} ‚Ä¢ Video: {{ formatBytes(stats.kpis.videoBytes || 0) }} ‚Ä¢ T·ªïng: {{ formatBytes(stats.kpis.totalBytes || 0) }}
        </div>
      </div>

      <div class="chart-card">
        <h2 class="chart-title">T·ªïng quan Assets</h2>
        <app-chart
          type="pie"
          [labels]="['Images','Videos','Other']"
          [values]="[stats.kpis.totalImages || 0, stats.kpis.totalVideos || 0, (stats.kpis.totalAssets || 0) - ((stats.kpis.totalImages || 0) + (stats.kpis.totalVideos || 0))]"
        ></app-chart>
      </div>
    </div>

    <div class="charts-section" style="gap:var(--spacing-4);">
      <div class="chart-card" style="flex:1;">
        <h2 class="chart-title">Phim xem nhi·ªÅu</h2>
        @if (stats.topViewedMovies && stats.topViewedMovies.length) {
          <ul class="list-group">
            @for (mv of stats.topViewedMovies; track mv.id) {
              <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                  <div class="fw-bold">{{ mv.title }}</div>
                  <div class="small text-muted">Lo·∫°i: {{ mv.type }} ‚Ä¢ Ng√†y ph√°t: {{ mv.releaseDate ?? '‚Äî' }}</div>
                </div>
                <div class="text-end">
                  <div class="fw-semibold">{{ formatNumber(mv.viewCount || 0) }}</div>
                  <div class="small text-muted">views</div>
                </div>
              </li>
            }
          </ul>
        }
        @else {
        <div class="text-muted">Kh√¥ng c√≥ phim n√†o</div>
        }
      </div>

      <div class="chart-card" style="flex:1;">
        <h2 class="chart-title">Phim m·ªõi</h2>
        @if (stats.recentMovies && stats.recentMovies.length) {
          <ul class="list-group">
            @for (mv of stats.recentMovies; track mv.id) {
              <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                  <div class="fw-bold">{{ mv.title }}</div>
                  <div class="small text-muted">Lo·∫°i: {{ mv.type }} ‚Ä¢ Ng√†y: {{ mv.releaseDate ?? '‚Äî' }}</div>
                </div>
                <div class="text-end">
                  <div class="small text-muted">{{ mv.genres?.length ? mv.genres.join(', ') : 'Kh√¥ng c√≥ th·ªÉ lo·∫°i' }}</div>
                </div>
              </li>
            }
          </ul>
        }
        @else {
        <div class="text-muted">Kh√¥ng c√≥ phim m·ªõi</div>
        }
      </div>
    </div>

    <div class="recent-activity">
      <h2 class="activity-title">V·∫•n ƒë·ªÅ & th√¥ng b√°o</h2>

      @if (stats.issues && stats.issues.length) {
        <div class="activity-list">
          @for (it of stats.issues; track it.title) {
            <div class="activity-item">
              <span class="activity-icon">‚ö†Ô∏è</span>
              <div class="activity-content">
                <p class="activity-action">{{ it.title }}</p>
                <p class="activity-time small text-muted">{{ it.description }}</p>
                @if (it.link) { <a href="{{ it.link }}" class="small">Xem chi ti·∫øt</a> }
              </div>
            </div>
          }
        </div>
      }
      @else {
      <div class="text-muted">Kh√¥ng c√≥ v·∫•n ƒë·ªÅ n√†o.</div>
      }
    </div>
  }
</div>
