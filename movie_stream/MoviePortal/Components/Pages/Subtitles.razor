@page "/admin/movies/{MovieId:int}/subtitles/{Lang?}"
@page "/admin/movies/{MovieId:int}/episodes/{EpisodeId:int}/subtitles/{Lang?}"
@rendermode InteractiveServer

<PageTitle>Thêm phụ đề</PageTitle>

<h5 class="mb-3">
  @if (EpisodeId is null)
  {
    <text>Phụ đề — Phim @MovieId</text>
  }
  else
  {
    <text>Phụ đề — Phim @MovieId • Tập @EpisodeId</text>
  }
</h5>

@if (_error is not null)
{
  <div class="alert alert-danger">@_error</div>
}

@if (_isBusy)
{
  <div class="position-fixed top-0 start-0 w-100 h-100 bg-dark bg-opacity-50 d-flex align-items-center justify-content-center" style="z-index:1050;">
    <div class="bg-white rounded-3 shadow p-4 text-center" style="min-width:320px">
      <div class="spinner-border mb-3" role="status"></div>
      <div class="fw-semibold">@_busyText</div>
      <div class="text-muted small">Vui lòng đợi…</div>
    </div>
  </div>
}

<div class="card shadow-sm">
  <div class="card-body">
    <h6 class="card-title mb-3">Upload phụ đề VTT (raw)</h6>

    <div class="row g-2 align-items-center">
      <div class="col-4">
        <label class="form-label mb-1">Ngôn ngữ (code)</label>
        <InputText class="form-control form-control-sm" @bind-Value="_lang" />
        <div class="form-text">vd: vi, en, ja…</div>
      </div>
      <div class="col-8">
        <label class="form-label mb-1">Nhãn hiển thị</label>
        <InputText class="form-control form-control-sm" @bind-Value="_label" />
      </div>
    </div>

    <div class="mt-2">
      <label class="form-label mb-1">Chọn file .vtt</label>
      <InputFile OnChange="UploadRawVtt" accept=".vtt" />
    </div>

    @if (!string.IsNullOrEmpty(_uploadedUrl))
    {
      <div class="alert alert-success mt-3">
        Upload thành công. URL: <a href="@_uploadedUrl" target="_blank" rel="noopener">@_uploadedUrl</a>
      </div>
    }
  </div>
</div>
